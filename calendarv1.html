<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>g-calendar test</title>
	<style>
/*css goes here*/
	</style>

<script type="text/javascript">
// global variables
var CLIENT_ID = "781532624008-amifuh5lt04sdbba90gojoq2tr656rse.apps.googleusercontent.com";
var API_KEY ="AIzaSyA9T6mlurcWf2Bxqk5XLMCsdUYQML3zQW8";
var SCOPES = ["https://www.googleapis.com/auth/calendar.readonly"];
var CAL_ID = "dmail.dixie.edu_o8rcipn2b5um5tc9b1ssjuo0mo@group.calendar.google.com";
var EVENT_TYPES = ["Abdul","Zane","Nick"];

function getWeek() {
	today= new Date();
	var dayofWeek = today.getDay();
	var diff = today.getDate() - dayofWeek + 1;
	var monday =  new Date(today.setDate(diff));
	today= new Date();
	var diff = today.getDate() - dayofWeek + 5;
	var friday =  new Date(today.setDate(diff));
	return {"monday":monday,"friday":friday};
}

//check authorization on load?
	function handleClientLoad() {
		gapi.client.setApiKey(API_KEY);
		window.setTimeout(checkAuth,1);
			checkAuth();
	}
//checks to see if app is authorized, on callbak runs handleAuthResult
	function checkAuth() {
		gapi.auth.authorize({client_id: CLIENT_ID, scope: SCOPES, immediate: true},
				handleAuthResult);
	}
//callback to handle results of checkAuth
	function handleAuthResult(authResult) {
		var authorizeButton = document.getElementById('authorize-button');
		//if authorized make makeApiCall
		if (authResult) {
			authorizeButton.style.visibility = 'hidden';
			makeApiCall();
		//else show authorization button
		} else {
			authorizeButton.style.visibility = '';
			authorizeButton.onclick = handleAuthClick;
		 }
	}
//handler to make authorization request
	function handleAuthClick(event) {
		gapi.auth.authorize(
			{client_id: CLIENT_ID, scope: SCOPES, immediate: false},
			handleAuthResult);
		return false;
	}

//makes api call and handles results of authenticated request
	function makeApiCall() {
	var week = getWeek();
	gapi.client.load('calendar', 'v3', function() {
		var request = gapi.client.calendar.events.list({
			'calendarId': CAL_ID,
			'timeMin': week.monday.toISOString(),
			'timeMax': week.friday.toISOString(),
			'showDeleted': false,
			'singleEvents': true,
			'maxResults': 1000,
			'orderBy': 'startTime',
		});

		request.execute(function(resp) {
			for (var i = 0; i < resp.items.length; i++) {
				var event = resp.items[i];
				var eventTime = event.start.dateTime;
				eventTime  = new Date(Date.parse(eventTime));
				eventTime = eventTime.toLocaleTimeString('en-US', { hour12: true,  hour:"numeric",minute:"2-digit" });
				var calEvent = document.createElement('div');
				calEvent.setAttribute('class','cal-event')
				calEvent.innerHTML =  '<p>' + event.summary + '<br> @' + eventTime + '</p>';
				var eventsDiv = document.getElementById("events");
				eventsDiv.appendChild(calEvent);
			}
		});
	});
}

</script>
</head>
<body>
  <div id='content'>
	<h1>Events</h1>
	<ul id='events'></ul>
  </div>
  <a href='#' id='authorize-button' onclick='handleAuthClick();'>Login</a>

  <script>
	// Insert the JS from above, here.
  </script>
  <script src="https://apis.google.com/js/client.js?onload=handleClientLoad"></script>
</body>
</html>
</html>
